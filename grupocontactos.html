<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Relacion Grupo Contactos</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


	<link href="css/datepicker3.css" rel="stylesheet">
	<link href="css/styles.css" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
	<!-- Ionicons -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
	<!-- fullCalendar 2.2.5-->
	<link rel="stylesheet" href="css/fullcalendar/fullcalendar.min.css">
	<link rel="stylesheet" href="css/fullcalendar/fullcalendar.print.css" media="print">
	<!-- Theme style -->
	<link rel="stylesheet" href="css/AdminLTE.min.css">
	<!-- AdminLTE Skins. Choose a skin from the css/skins
	   folder instead of downloading all of them to reduce the load. -->

	

	<!--Icons-->
  	<script src="js/lumino.glyphs.js"></script>

</head>
<body>

	  <!--Barra Navegacion-->
	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container-fluid">
		  <div class="navbar-header">
		    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse">
		      <span class="sr-only">Toggle navigation</span>
		      <span class="icon-bar"></span>
		      <span class="icon-bar"></span>
		      <span class="icon-bar"></span>
		    </button>
		    <a class="navbar-brand" href="#"><span>Trazabilidad</span>DACE</a>
		    <ul class="user-menu">
		      <li class="dropdown pull-right">
		        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><svg class="glyph stroked male-user"><use xlink:href="#stroked-male-user"></use></svg> User <span class="caret"></span></a>
		        <ul class="dropdown-menu" role="menu">
		          <li><a href="#"><svg class="glyph stroked male-user"><use xlink:href="#stroked-male-user"></use></svg> Profile</a></li>
		          <li><a href="#"><svg class="glyph stroked gear"><use xlink:href="#stroked-gear"></use></svg> Settings</a></li>
		          <li><a href="#"><svg class="glyph stroked cancel"><use xlink:href="#stroked-cancel"></use></svg> Logout</a></li>
		        </ul>
		      </li>
		    </ul>
		  </div>
		          
		</div><!-- /.container-fluid -->
	</nav>

  <!--Barra Herramientas-->
	<div id="sidebar-collapse" class="col-sm-3 col-lg-2 sidebar">
		<form role="search">
		  <div class="form-group">
		    <input type="text" class="form-control" placeholder="Search">
		  </div>
		</form>
		<ul class="nav menu">

		  

		  <li class="parent ">
		    <a href="index.html">
		      <span data-toggle="collapse" href="#sub-item-1"><svg class="glyph stroked dashboard-dial"><use xlink:href="#stroked-dashboard-dial"></use></svg></span> Tablero 
		    </a>
		    <ul class="children collapse" id="sub-item-1">
		      <li>
		        <a class="" href="indicadores.html">
		          <svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Indicadores Contingentes
		        </a>
		      </li>
		    </ul>
		  </li>

		<li class="parent">
			<a href="calendar.html">
				<span data-toggle="collapse" href="#subItemGrupo"><svg class='glyph stroked calendar'><use xlink:href="#stroked-calendar"></use></svg></span> Alertas
			</a>

			<ul class="children collapse" id="subItemGrupo">
				<li>
					<a href="grupos.html" >
						<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg>
						Grupos
					</a>
				</li>
				<li>
					<a href="contactos.html">
						<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg>
						Contactos
					</a>
				</li>
				<li>
					<a href="contactos_contingentes.html">
						<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg>
						Contactos Contingentes
					</a>
				</li>
				<li>
					<a href="grupocontactos.html">
						<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg>
						Relacion Contacto - Grupo
					</a>
				</li>				
			</ul>
		</li>
		  
		  <li><a href="reportes.html"><svg class="glyph stroked table"><use xlink:href="#stroked-table"></use></svg> Reportes </a></li>
		  
		  <li class="parent ">
		    <a href="#">
		      <span data-toggle="collapse" href="#sub-item-1"><svg class="glyph stroked chevron-down"><use xlink:href="#stroked-chevron-down"></use></svg></span> Proceso 
		    </a>
		    <ul class="children collapse" id="sub-item-1">
		      <li>
		        <a class="" href="#">
		          <svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Inscripciones
		        </a>
		      </li>
		      <li>
		        <a class="" href="#">
		          <svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Solicitudes
		        </a>
		      </li>
		      <li>
		        <a class="" href="#">
		          <svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Aprobaciones
		        </a>
		      </li>
		    </ul>
		  </li>
		  <li role="presentation" class="divider"></li>
		  <li><a href="login.html"><svg class="glyph stroked male-user"><use xlink:href="#stroked-male-user"></use></svg> Login Page</a></li>
		</ul>
	</div><!--/.sidebar-->

	<!-- Formulario de edicion de evento -->
	<div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">

		<div class="row">
			<ol class="breadcrumb">
				<li><a href="#"><svg class="glyph stroked home"><use xlink:href="#stroked-home"></use></svg></a></li>
				<li class="active">Grupo - Contactos</li>
			</ol>
		</div><!--/.row-->

		<div class="row">
			<div class="col-lg-12">
				<h1 class="page-header">Grupo - Contactos</h1>
			</div>
		</div><!--/.row-->

	 	<div id="contenido" >
	            
	            <!--<input id="btn_usuarios" type="button" class="btn btn-primary" value="Nuevo Grupo"/><br/><br/>-->
	            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">Relacionar</button><br/><br/>
	            
	            <div class="panel panel-primary">
	                <div class="panel-heading">
	                    <h3 class="panel-title">Listado Grupo - Contactos </h3>
	                </div>
	                <div class="panel-body">
	                    <table id="tablaContactos" class="table table-striped">
	                        <thead>                        
	                        <th>Contacto</th>
	                        <th>Grupo</th>
	                        <th>Editar</th>
	                        <th>Eliminar</th>
	                        </thead>
	                        <tbody>
	                           
	                        </tbody>
	                    </table>
	                </div>
	            </div>
	    </div>

	   	<!-- Modal -->
		<div id="myModal" class="modal fade" role="dialog">
		  <div class="modal-dialog">

		    <!-- Modal content-->
		    <div class="modal-content">
		    	<form id="formContacto" class="form-horizontal" role="form">
			      	<div class="modal-header">
			        	<button type="button" class="close" data-dismiss="modal">&times;</button>
			        	<h4 id="modo" class="modal-title">Nuevo</h4>
			        	<h4 class="modal-title">Relacion Grupo - Contacto</h4>
			      	</div>

			      	<div class="modal-body">
			        	<div class="form-group">
			        		<label class="col-lg-2 control-label">Id:</label>
			        		<div class="col-lg-10">
			        			<input id="idGrupoContacto" type="text" name="idGrupoContacto" class="form-control" disabled="true">
			        		</div>
			        	</div>

						<div class="form-group">
			        		<label class="col-lg-2 control-label">Contacto:</label>
			        		<div class="col-lg-10">
			        			<select id='cbocontacto' name='cbocontacto' class="form-control">
										<option>Seleccione una Opcion...</option>
								</select>
			        		</div>
			        	</div>

						<div class="form-group">
			        		<label class="col-lg-2 control-label">Grupo:</label>
			        		<div class="col-lg-10">		        			
			        			<select id='cbogrupo' name='cbogrupo' class="form-control">
										<option>Seleccione una Opcion...</option>
								</select>			        			
			        		</div>
			        	</div>			        	


			      	</div>
			      	<div class="modal-footer">
			        	<button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
			        	<button id="guardar" type="submit" class="btn btn-primary" >Guardar</button>
			      </div>
			    </form>
		    </div>

		  </div>
		</div>

	</div>

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="js/moment.min.js"></script>

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<script src="js/bootstrap-datepicker.js"></script>

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>

    <script type="text/javascript">

	    $(function () {

			TableContactos();

	    	LlenoGrupos();
	    	LlenoContactos();

	        $("#formContacto").submit(function (event){

	        	$modo = $('#modo').text();

	        	if ($modo == 'Nuevo') {
       		
		        	$idGrupo = $('#cbogrupo').val();
		        	$idContacto = $('#cbocontacto').val();
		        	

		        	$.ajax({
		        		type: "GET",
		        		url: 'actionsCalendar.php',
		        		data: "action=InsertContactoGrupo&idGrupo="+$idGrupo+"&idContacto="+$idContacto
		        	})
		        	.done(function(response){
		        		return true;
		        	})
		        	.fail(function(jqXHR, estado){
		        		console.log("Ha ocurrido un error al insertar nueva relacion grupo contacto.");
		        	})	
		        	
	        	} else {


	        		$idGrupoContacto = $('#idGrupoContacto').val();
	        		$idGrupo = $('#cbogrupo').val();
	        		$idContacto = $('#cbocontacto').val();
	        		

	        		$.ajax({
	        			type: "GET",
	        			url: 'actionsCalendar.php',
	        			data: "action=UpdateContactoGrupo&idGrupoContacto="+$idGrupoContacto+"&idGrupo="+$idGrupo+"&idContacto="+$idContacto
	        		})
	        		.done(function(response){
	        			$("#modo").text('Nuevo');
	        			return true;
	        		})
	        		.fail(function(jqXHR, estado){
	        			console.log("Ha ocurrido un error al actualizar relacion grupo contacto.")
	        		})

	        	}

	        });

	    });


 	    function TableContactos() {
	    	$.ajax({
	    		url:'actionsCalendar.php',
	    		type: 'GET',
	    		dataType: 'json',
	    		data: 'action=SelectContactosGrupos'
	    	})
	    	.done(function(response) {
	    		var html = '';

	    		if (response.result == true) {
	    			$(response.datos).each(function(i,v) {
	    				html += '<tr>'
	    				html += '<td>'+v.nombreContacto+'</td>'
	    				html += '<td>'+v.nombreGrupo+'</td>'
	    				html += '<td><button class="btn btn-primary" onclick="editar('+ v.idcontacto_grupo+')">Editar</button></td>';
	    				html += '<td><button class="btn btn-primary" onclick="eliminar('+ v.idcontacto_grupo+')">Eliminar</button></td>';
	    				html += '</tr>';
	    			})
	    		}else{
	    			html = '<tr><td colspan="6">No se encontraron registros.</td></tr>'

	    		}

	    		$("#tablaContactos tbody").html(html);
	    	})
	    	.fail(function(jqXHR, estado) {
	    		console.log("Ha ocurrido un error al consultar contactos.")
	    	})
	    }

	    function editar(idContactoGrupo) {
	    	$("#modo").text('Editar');

	    	$.ajax({
	    		url: 'actionsCalendar.php',
	    		type: 'GET',
	    		dataType: 'json',
	    		data: 'action=SelectContactoGrupo&idContactoGrupo='+idContactoGrupo
	    	})
	    	.done(function(response){

	    		if (response.result == true) {
	    			$(response.datos).each(function(i, v) {
	    				$('#idGrupoContacto').val(idContactoGrupo);
	    				$('#cbogrupo').val(v.idgrupo);
	    				$('#cbocontacto').val(v.idcontacto);
	    				
	    			})
	    		}

	    		$("#myModal").modal('show');
	    	})
	    	.fail(function(jqXHR, estado) {
	    		console.log("Ha ocurrido un error al consultar relacion contacto grupo.")
	    	})
	    }


		function LlenoGrupos(){
			$.ajax({
				url: 'actionsCalendar.php',
				type: 'GET',
				dataType: 'json',
				data: "action=getListaGrupos",
				cache:false
			})
			.done(function(response){
				if (response.result == true) {	
					//Recorro los datos y lleno el combo
					
					var options = "";
					var listaGrupos = $("#cbogrupo");

					listaGrupos.find('option').remove();
					
					listaGrupos.append('<option value="'+0+'">Seleccione Opcion</option>');
					$(response.datos).each(function(i,v){				
						listaGrupos.append('<option value="'+v.idGrupo+'">'+v.nombre+'</option>');
					});

				}else{
					alert(response.mensaje);
				}
			})
			.fail(function(jqXHR, estado){
				console.log('Ha ocurrido un error al consultar grupos.')
			})
		}

		function LlenoContactos(){
			$.ajax({
				url: 'actionsCalendar.php',
				type: 'GET',
				dataType: 'json',
				data: "action=getListaContactos",
				cache:false
			})
			.done(function(response){
				if (response.result == true) {	
					//Recorro los datos y lleno el combo
					
					var options = "";
					var listaContactos = $("#cbocontacto");

					listaContactos.find('option').remove();
					
					listaContactos.append('<option value="'+0+'">Seleccione Opcion</option>');
					$(response.datos).each(function(i,v){				
						listaContactos.append('<option value="'+v.idContacto+'">'+v.nombre+'</option>');
					});

				}else{
					alert(response.mensaje);
				}
			})
			.fail(function(jqXHR, estado){
				console.log('Ha ocurrido un error al consultar contactos.')
			})
		}

	</script>

</body>
</html>