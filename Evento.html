<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Evento</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


	<link href="css/datepicker3.css" rel="stylesheet">
	<link href="css/styles.css" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
	<!-- Ionicons -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
	<!-- fullCalendar 2.2.5-->
	<link rel="stylesheet" href="css/fullcalendar/fullcalendar.min.css">
	<link rel="stylesheet" href="css/fullcalendar/fullcalendar.print.css" media="print">
	<!-- Theme style -->
	<link rel="stylesheet" href="css/AdminLTE.min.css">
	<!-- AdminLTE Skins. Choose a skin from the css/skins
	   folder instead of downloading all of them to reduce the load. -->

	

	<!--Icons-->
  	<script src="js/lumino.glyphs.js"></script>

</head>
<body>

	<!--Barra Navegacion-->
	<!--<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container-fluid">
		  <div class="navbar-header">
		    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse">
		      <span class="sr-only">Toggle navigation</span>
		      <span class="icon-bar"></span>
		      <span class="icon-bar"></span>
		      <span class="icon-bar"></span>
		    </button>
		    <a class="navbar-brand" href="#"><span>Trazabilidad</span>DACE</a>
		    <ul class="user-menu">
		      <li class="dropdown pull-right">
		        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><svg class="glyph stroked male-user"><use xlink:href="#stroked-male-user"></use></svg> User <span class="caret"></span></a>
		        <ul class="dropdown-menu" role="menu">
		          <li><a href="#"><svg class="glyph stroked male-user"><use xlink:href="#stroked-male-user"></use></svg> Profile</a></li>
		          <li><a href="#"><svg class="glyph stroked gear"><use xlink:href="#stroked-gear"></use></svg> Settings</a></li>
		          <li><a href="#"><svg class="glyph stroked cancel"><use xlink:href="#stroked-cancel"></use></svg> Logout</a></li>
		        </ul>
		      </li>
		    </ul>
		  </div>
		          
		</div>
	</nav>-->

	<!--Barra Herramientas-->
	<div id="sidebar-collapse" class="col-sm-3 col-lg-2 sidebar">

		<form role="search">
			<div class="form-group">
				<input type="text" class="form-control" placeholder="Search">
			</div>
		</form>

		<ul class="nav menu">

			<!-- Menu Alertas -->
			<li class="parent">
				<a href="calendar.html">
					<span data-toggle="collapse" href="#subItemGrupo"><svg class='glyph stroked calendar'><use xlink:href="#stroked-calendar"></use></svg></span> Alertas
				</a>

				<ul class="children collapse" id="subItemGrupo">
					<li>
						<a href="grupos.html" >
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg>
							Grupos
						</a>
					</li>
					<li>
						<a href="contactos.html">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg>
							Contactos
						</a>
					</li>
					<li>
						<a href="contactos_contingentes.html">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg>
							Contactos Contingentes
						</a>
					</li>
					<li>
						<a href="grupocontactos.html">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg>
							Relacion Contacto - Grupo
						</a>
					</li>
				</ul>
			</li>

			<li role="presentation" class="divider"></li>

			<!-- Menu Contingentes -->
			<li class="parent ">
				<a href="#">
					<span data-toggle="collapse" href="#sub-item-contingentesPro"><svg class="glyph stroked chevron-down"><use xlink:href="#stroked-chevron-down"></use></svg></span>Contingentes
				</a>
				<ul class="children collapse" id="sub-item-contingentesPro">

					<li>
						<a href="index.html">
							<span data-toggle="collapse" href="#sub-item-1"><svg class="glyph stroked dashboard-dial"><use xlink:href="#stroked-dashboard-dial"></use></svg></span> Tablero 
						</a>
						<ul class="children collapse" id="sub-item-1">
							<li>
								<a href="indicadores.html">
									<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Indicadores Contingentes
								</a>
							</li>
						</ul>
					</li>


					<li>
						<a href="procesoContingentes.html">
							<span data-toggle="collapse" href="#sub-item-contingentes"><svg class="glyph stroked chevron-down"><use xlink:href="#stroked-chevron-down"></use></svg></span> Proceso Contingentes
						</a>
						<ul class="children collapse" id="sub-item-contingentes">
							<li>
								<a class="" href="#">
									<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> 1. Inscripción
								</a>
							</li>
							<li>
								<a class="" href="#">
									<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> 2. Asignación
								</a>
							</li>
							<li>
								<a class="" href="#">
									<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> 3. Emisión
								</a>
							</li>
						</ul>
					</li>

					<li><a href="reportes.html"><svg class="glyph stroked table"><use xlink:href="#stroked-table"></use></svg> Reportes </a></li>
				</ul>
			</li>
			
			<li role="presentation" class="divider"></li>

			<!-- Menu Unidad Origen -->
			<li class="parent">
				<a href="#">
					<span data-toggle="collapse" href="#SubItemOrigenPro"><svg class="glyph stroked chevron-down"><use xlink:href="#stroked-chevron-down"></use></svg></span>Unidad Origen
				</a>
				<ul class="children collapse" id="SubItemOrigenPro">
					<li>
						<a class="" href="#">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Ingreso de Expediente
						</a>
					</li>
					<li>
						<a class="" href="#">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Resolucion Inicial
						</a>
					</li>
				</ul>
			</li>

			<li role="presentation" class="divider"></li>

			<!-- Menu Unidad Defensa Comercial -->
			<li class="parent">
				<a href="#">
					<span data-toggle="collapse" href="#SubItemDefensaPro"><svg class="glyph stroked chevron-down"><use xlink:href="#stroked-chevron-down"></use></svg></span>Defensa Comercial
				</a>
				<ul class="children collapse" id="SubItemDefensaPro">

					<li>
						<a href="defensa/actividades.html">
							<span data-toggle="collapse" href="#subItemDefensaActi"><svg class="glyph stroked chevron-down"><use xlink:href="#stroked-chevron-down"></use></svg></span> Agregar Actividad
						</a>
						<ul class="children collapse" id="subItemDefensaActi">
							<li>
								<a class="" href="defensa/temas.html">
									<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Temas
								</a>
							</li>
							<li>
								<a class="" href="defensa/tipoActividad.html">
									<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Tipo Actividad
								</a>
							</li>
						</ul>
					</li>

					<li>
						<a class="" href="#">
							<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Tablero Indicadores
						</a>
					</li>
				</ul>
			</li>

			<li role="presentation" class="divider"></li>
			<li><a href="login.html"><svg class="glyph stroked male-user"><use xlink:href="#stroked-male-user"></use></svg> Login Page</a></li>
		</ul>
	</div>

	<!-- Formulario de edicion de evento -->
	<div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">

		<div class="row">
			<ol class="breadcrumb">
				<li><a href="#"><svg class="glyph stroked home"><use xlink:href="#stroked-home"></use></svg></a></li>
				<li class="active">Evento</li>
			</ol>
		</div><!--/.row-->

		<div class="row">
			<div class="col-lg-12">
				<h1 class="page-header">Editar Evento</h1>
			</div>
		</div><!--/.row-->

		<form id="formEvento" class="form-horizontal" role="form">

			<!-- Id del Evento -->
			<div class="form-group">
				<label for="idEvento" class="col-lg-2 control-label">ID</label>
				<div class="col-lg-10">
					<input id="idEvento" type="text" class="form-control" name="idEvento" disabled="true">
				</div>
			</div>

			<!-- Nombre del evento -->
			<div class="form-group">
				<label class="col-lg-2 control-label"> Nombre Evento </label>
				<div class="col-lg-10">
					<input id="nombreEvento" type="text" class="form-control" placeholder="Nombre del Evento" name="nombreEvento">	
				</div>
			</div>

			<!-- Fechas del evento -->
			<div class="form-group">
					<!-- Fecha de inicio -->
					<label class="col-lg-2 control-label" > Fecha de Inicio </label>
					<div class="col-lg-4">
						<div class='input-group date' id='datetimepicker1'>
		                    <input id="fechaInicio" type='text' class="form-control" />
		                    <span class="input-group-addon">
		                        <span class="glyphicon glyphicon-calendar"></span>
		                    </span>
	                	</div>	
					</div>

					<label class="col-lg-2 control-label" > Fecha de Finalizacion </label>
					<div class='col-lg-4'>
	                	<div class='input-group date' id='datetimepicker2'>
		                    <input id="fechaFinal" type='text' class="form-control" />
		                    <span class="input-group-addon">
		                        <span class="glyphicon glyphicon-calendar"></span>
		                    </span>
	                	</div>	
	                </div>
			</div>

			<!-- Caja de colores -->
			<div class="form-group">
				<label class="col-xs-2 control-label"> Color del Evento </label>
            	<div class="col-xs-6 btn-group" >
	                <!--<button type="button" id="color-chooser-btn" class="btn btn-info btn-block dropdown-toggle" data-toggle="dropdown">Color <span class="caret"></span></button>-->
	                <ul class="fc-color-picker" id="color-chooser">
	                  <li><a class="text-aqua" href="#"><i class="fa fa-square"></i></a></li>
	                  <li><a class="text-blue" href="#"><i class="fa fa-square"></i></a></li>
	                  <li><a class="text-light-blue" href="#"><i class="fa fa-square"></i></a></li>
	                  <li><a class="text-teal" href="#"><i class="fa fa-square"></i></a></li>
	                  <li><a class="text-yellow" href="#"><i class="fa fa-square"></i></a></li>
	                  <li><a class="text-orange" href="#"><i class="fa fa-square"></i></a></li>
	                  <li><a class="text-green" href="#"><i class="fa fa-square"></i></a></li>
	                  <li><a class="text-lime" href="#"><i class="fa fa-square"></i></a></li>
	                  <li><a class="text-red" href="#"><i class="fa fa-square"></i></a></li>
	                  <li><a class="text-purple" href="#"><i class="fa fa-square"></i></a></li>
	                  <li><a class="text-fuchsia" href="#"><i class="fa fa-square"></i></a></li>
	                  <li><a class="text-muted" href="#"><i class="fa fa-square"></i></a></li>
	                  <li><a class="text-navy" href="#"><i class="fa fa-square"></i></a></li>
	                </ul>
              	</div>
              	
              	<div class="col-xs-4">
                	<input id="color" type="text" class="form-control" placeholder="Color">
              	</div>
			</div>

			<!-- Evento todo el dia -->
			<div class="form-group">
				<div class="col-lg-offset-2 col-lg-10">
					<div class="checkbox">
						<label>
						  <input id="checkboxTodoeldia" type="checkbox"> Todo el dia
						</label>
					</div>	
				</div>
			</div>			

			<!-- Lugar -->
			<div class="form-group">
				<label class="col-lg-2 control-label">Lugar </label>
				<div class="col-lg-10">
					<input id="lugar" type="text" class="form-control" placeholder="Lugar" name="lugar	">	
				</div>
			</div>

			<!-- Descripcion -->
			<div class="form-group">
				<label class="col-lg-2 control-label"> Descripcion </label>
				<div class="col-lg-10">
					<textarea id="descripcion" type="text" class="form-control" placeholder="Descripcion" name="descripcion"></textarea>	
				</div>
			</div>

			<!-- Grupo -->
			<div class="form-group">
				<label class="col-lg-2 control-label"> Grupo de contactos </label>
				<div class="col-lg-10">
					<select id="grupocontactos" class="form-control" name="grupocontactos">
						<option>Seleccione una opcion...</option>						
					</select>	
				</div>
			</div>

			<!-- Otros Correos -->
			<div class="form-group">
				<label class="col-lg-2 control-label" for="ejemplo_email_1">Otros Correos</label>
				<div class="col-lg-10">
					<input type="text" class="form-control" id="otrosCorreos" placeholder="Introduce los correos">	
				</div>
			</div>

			<!-- Adjuntar Archivos -->
			<!--
			<form enctype="multipart/form-data"  id="formArchivo">
				<div class="form-group">
					<label class="col-lg-2 control-label" for="ejemplo_archivo_1">Adjuntar un archivo</label>
					<div class="col-lg-10">
						<input type="file" id="adjuntarArchivo" name="adjuntarArchivo">
						<input type="button" value="Subir" id="subirArchivo">	
					</div>
				</div>
			</form>-->
			<!--div para visualizar mensajes-->
    		<div id="mensajes"></div>
			

			<!--  Enviar alerta de creacion de evento -->
			<div class="form-group">
				<div class="col-lg-offset-2 col-lg-10">
					<div class="checkbox">
						<label>
						  <input  id="checkboxAlerta" type="checkbox"> Enviar alerta de creacion de evento
						</label>
					</div>		
				</div>
			</div>
			
			<!-- Boton de Guardar -->
			<div class="form-group">
				<div class="col-lg-offset-2 col-lg-10">
					<button id="Guardar" type="submit" class="btn btn-primary">Guardar</button>		
				</div>
			</div>

		</form>
	</div>

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="js/moment.min.js"></script>

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<script src="js/bootstrap-datepicker.js"></script>

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>

    <script type="text/javascript">

    	$(document).ready(function() {

    		LlenoGrupos();

    	});

	    $(function () {
	        $('#datetimepicker1').datetimepicker();
	        $('#datetimepicker2').datetimepicker();

	        $('#color').prop('disabled', true);

	        var idevento = $_GET("idevento");

	        $('#idEvento').val(idevento);

			/*LlenoGrupos();*/

	        CargaEvento(idevento);

	        $("#mensajes").hide();
	        var fileExtension = "";

			$(':file').change(function(){
				//Obtenemos un array con datos del archivo
				var file = $("#adjuntarArchivo")[0].files[0];
				//Obtenemos el nombre del archivo
				var filename = file.name;
				//Obtenemos la extension del archivo
				fileExtension = filename.substring(filename.lastIndexOf('.')+1);
				//Obtenemos el tama;o del archivo
				var fileSize = file.size;
				//Obtenemos el tipo de archivo
				var fileType = file.type;
			});

			//al enviar el formulario
			$('#subirArchivo').click(function(event){
					registrarDocumentacion('#formArchivo');
			});
			

	        //Funcion para cambiar de color
	        $("#color-chooser > li > a").click(function (e) {
	          e.preventDefault();
	          //Save color
	          var currColor = $(this).css("color");

	          //Add color effect to button
	          $('#color').val(currColor);
	        });


	        //Metodo que almacena datos del formulario
			$('#formEvento').submit( function (event){

				event.preventDefault();


				$idEvento = $('#idEvento').val();
				$nombre = $('#nombreEvento').val();

				if ($('#checkboxTodoeldia').is(':checked')) {
					$todoeldia = 'S';
				}else{
					$todoeldia = 'N';
				}

				$fecha_inicia = moment($('#fechaInicio').val()).format('YYYY-MM-DD HH:mm:ss');				
				$fecha_finaliza = moment($('#fechaFinal').val()).format('YYYY-MM-DD HH:mm:ss');


				$color = $('#color').val();
				$lugar = $('#lugar').val();
				$descripcion = $('#descripcion').val();


				$adjunto = document.getElementById('#adjuntarArchivo');
				

				$idgrupo = $('#grupocontactos').val();
				$otroscorreos = $('#otrosCorreos').val();
				$estado = 'E';


				$enviocorreo = 'NULL';

				//Si el envio de alerta de creacion de evento esta activo
				if ($('#checkboxAlerta').is(':checked')) {
					$enviocorreo = 'S';			
				}

				//Llamo a la funcion que almacena los datos
				UpdateEventoMain($idEvento, $nombre, $todoeldia, $fecha_inicia, 
					$fecha_finaliza, $color, $lugar, $descripcion, 
					$adjunto, $idgrupo, $otroscorreos, $enviocorreo, $estado).done(function(response){

					if (response.result == true) {

						var envioAlerta = false;
						//Consulto si el evento se envia correo
						verificaAlerta($idEvento).done(function(data) {

							if (data.datos.alerta > 0) {
								envioAlerta = true;
							}else{
								envioAlerta = false;
							}
						})

						//Si el evento tiene activadas las notificaciones
						if (envioAlerta == true) {

							var SiEnvia = false;

							//Construye el contenido del correo
							var contenido = '<strong>Lugar:</strong> '+$lugar+'<br>';
							contenido = contenido+'<strong> Inicia: </strong> '+$fecha_inicia+' <strong> Termina: </strong> '+$fecha_finaliza+'<br>';
							contenido = contenido+'<strong> Descripcion </strong><br><p> '+$descripcion+'<p>';

							

							//Verifico si existe grupo para enviar correos
							if ($idgrupo > 0) {

								var arregloGrupo = new Array();

								ObtengoDatosGrupo($idgrupo).done(function (datos) {

									arregloGrupo = datos;

									if (arregloGrupo.result == true) {

										$(arregloGrupo.datos).each(function(i, v){
											
											EnvioNotificacionEvento(v.correo, v.nombre, $nombre, contenido).done(function (data) {
												SiEnvia = true;
											}).fail(function (data) {
												SiEnvia = false;
											})
											
										});
									}
									
									
								})

							}
						
							/*
								Realizo envio por cada uno de los correos de otros correos
							*/

							if ($otroscorreos.length > 0) {
								var emails = $otroscorreos.split(","); //Creo un array con los e-mails ingresados y separados por comas
								valido = true; //Variable que indicará el estado de la validación
								 
								for (var i = 0, l = emails.length; i < l; i++){ //Recorro el array

								    if (!isValidEmail(emails[i])){ //Si el e-mail no es válido
								        valido = false; //El estado de la validación será false
								        //break; //Salgo del bucle
								    }else{
						    	
										EnvioNotificacionEvento(emails[i], emails[i], $nombre, contenido).done(
											function (data) {

											SiEnvia = true;
										}).fail(function (data) {

											SiEnvia = false;
										})	
								    }
								}
							}		

							//Si todos los correos se enviaron regresa al calendario
							if (SiEnvia == true) {
								window.location.href = "/contingentes/Calendar.html";	
							}else{
								//Si no muestra error
								console.log('Ha ocurrido un error al enviar correo.')
							}


						}else{

							window.location.href = "/contingentes/Calendar.html";	

						}

					}
					
				})
				.fail(function(jqXHR, estado){
					console.log('Ha ocurrido un error al consultar datos del evento.');
				})

			});

	    });

		function UpdateEventoMain($idEvento, $nombre, $todoeldia, $fecha_inicia, $fecha_finaliza, $color, $lugar, $descripcion, $adjunto, $idgrupo, $otroscorreos, $enviocorreo, $estado) {
			return 	$.ajax({
					type: "POST",
					url: 'actionsCalendar.php',
					dataType: 'json',
					data: "action=UpdateEventoFormulario&idevento="+$idEvento+"&nombre="+$nombre+"&todoeldia="+$todoeldia+"&fecha_inicia="+$fecha_inicia+"&fecha_finaliza="+$fecha_finaliza+"&color="+$color+"&lugar="+$lugar+"&descripcion="+$descripcion+"&adjunto="+$adjunto+"&idgrupo="+$idgrupo+"&otroscorreos="+$otroscorreos+"&enviocorreo="+$enviocorreo+"&estado="+$estado
				})
		}

		function verificaAlerta($idEvento) {
			return $.ajax({
				async: false,
				type: 'GET',
				url: 'actionsCalendar.php',
				dataType: 'json',
				data: "action=verificaEnviaCorreo&idEvento="+$idEvento
			})
		}

		//como la utilizamos demasiadas veces, creamos una función para 
		//evitar repetición de código
		function showMessage(message){
		    $("#mensajes").html("").show();
		    $("#mensajes").html(message);
		}

		function dataForm_Archivos(formulario){
		    var nuevoFormulario = new FormData();   
		    $(formulario).find(':input').each(function() {
		        var elemento= this;
		        //Si recibe tipo archivo 'file'
		        if(elemento.type === 'file'){
		           if(elemento.value !== ''){
		              for(var i=0; i< $('#'+elemento.id).prop("files").length; i++){
		                  nuevoFormulario.append(elemento.name, $('#'+elemento.id).prop("files")[i]);
		               }
		            }              
		         }
		     });

		  return nuevoFormulario;
		}

		function registrarDocumentacion(formulario){

			var datosForm = dataForm_Archivos(formulario);
console.log('datos del formulario registra Documentacion: ', datosForm);
			var request = $.ajax({
			    contentType: false,
			    processData: false,
			    data: datosForm,                         
			    type: 'GET',
			    url: 'uploader.php',
			    beforeSend:function(){

			     }

			    });

			    request.done(function(datos) { 

			});
		 }

	    function isValidEmail(mail)
		{
		    return /^\w+([\.\+\-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,4})+$/.test(mail);
		}


		function LlenoGrupos(){
			$.ajax({
				url: 'actionsCalendar.php',
				type: 'GET',
				dataType: 'json',
				data: "action=getListaGruposEvento",
				cache:false
			})
			.done(function(response){
				if (response.result == true) {	
					//Recorro los datos y lleno el combo
					
					var options = "";
					var listaGrupos = $("#grupocontactos");

					listaGrupos.find('option').remove();
					
					listaGrupos.append('<option value="'+0+'">Seleccione Opcion</option>');
					$(response.datos).each(function(i,v){				
						listaGrupos.append('<option value="'+v.idGrupo+'">'+v.nombre+'</option>');
					});

				}else{
					alert(response.mensaje);
				}
			})
			.fail(function(jqXHR, estado){
				console.log('Ha ocurrido un error al consultar grupos.')
			})
		}

	    function CargaEvento(idevento){

	    	$.ajax({
				
				url:'actionsCalendar.php',
				type:'GET',
				dataType: 'json',
				data: "action=SelectEvento&idevento="+idevento,
				cache: false
			})
			.done(function(response){

				if (response.result == true) {
					$(response.datos).each(function(i, v){

						

						$('#nombreEvento').val(v.nombre);

						var fechainicia = moment(v.fecha_inicia).format('MM/DD/YYYY HH:mm:ss');
						$('#fechaInicio').val(fechainicia);

						var fechaFinal = moment(v.fecha_finaliza).format('MM/DD/YYYY HH:mm:ss');
						$('#fechaFinal').val(fechaFinal);

						if (v.todoeldia == 'S') {

							$('#checkboxTodoeldia').prop('checked',true);
						}else{
							$('#checkboxTodoeldia').prop('checked',false);
						}
						
						
						$('#color').val	(v.color);

						$('#lugar').val(v.lugar);

						$('#descripcion').val(v.descripcion);

						//$('#adjunto').val(v.adjunto);


						if (v.idgrupo > 0) {
							$('#grupocontactos').val(v.idgrupo);
						}

						
						$('#otrosCorreos').val(v.otroscorreos);


						if (v.enviocorreo == 'S') {
							$('#checkboxAlerta').prop('checked', true);
						}else{
							$('#checkboxAlerta').prop('checked', false);
						}

						//Estado
					})
				}else{
					
				}

			})
			.fail(function(jqXHR, estado){
				console.log("Ha ocurrido un error al consultar datos del evento.");
			})
			.always(function(){
				console.log("Lleno formulario con datos del evento.");
			})
	    }
	    
	   	function $_GET(param){

			/* Obtener la url completa */
			url = document.URL;

			/* Buscar a partir del signo de interrogación ? */
			url = String(url.match(/\?+.+/));

			/* limpiar la cadena quitándole el signo ? */
			url = url.replace("?", "");

			/* Crear un array con parametro=valor */
			url = url.split("&");


			/*
			Recorrer el array url
			obtener el valor y dividirlo en dos partes a través del signo =
			0 = parametro
			1 = valor
			Si el parámetro existe devolver su valor
			*/

			x = 0;

			while (x < url.length){

				p = url[x].split("=");

				if (p[0] == param){
					return decodeURIComponent(p[1]);
				}
				x++;
			}
		}

		function ObtengoDatosGrupo($idGrupo/*, callback*/){
			return $.ajax({	
				async: false,			
				type: "GET",
				dataType: 'json',
				url: 'actionsCalendar.php',
				data: "action=SelectContactosNotificacion&idGrupo="+$idgrupo/*,
				success: callback*/
			})
		}

		function EnvioNotificacionEvento($para, $nombre, $asunto, $descripcion){


			return $.ajax({
				async: false,
				type: "GET",
				url: 'actionsCalendar.php',
				data: 'action=SendEmail&para='+$para+'&nombre='+$nombre+'&asunto='+$asunto+'&descripcion='+$descripcion
			})

		}
 
	</script>

</body>
</html>