<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Evento</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


	<link href="css/datepicker3.css" rel="stylesheet">
	<link href="css/styles.css" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
	<!-- Ionicons -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
	<!-- fullCalendar 2.2.5-->
	<link rel="stylesheet" href="css/fullcalendar/fullcalendar.min.css">
	<link rel="stylesheet" href="css/fullcalendar/fullcalendar.print.css" media="print">
	<!-- Theme style -->
	<link rel="stylesheet" href="css/AdminLTE.min.css">
	<!-- AdminLTE Skins. Choose a skin from the css/skins
	   folder instead of downloading all of them to reduce the load. -->

	

	<!--Icons-->
  	<script src="js/lumino.glyphs.js"></script>

</head>
<body>

	  <!--Barra Navegacion-->
	<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<div class="container-fluid">
		  <div class="navbar-header">
		    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#sidebar-collapse">
		      <span class="sr-only">Toggle navigation</span>
		      <span class="icon-bar"></span>
		      <span class="icon-bar"></span>
		      <span class="icon-bar"></span>
		    </button>
		    <a class="navbar-brand" href="#"><span>Trazabilidad</span>DACE</a>
		    <ul class="user-menu">
		      <li class="dropdown pull-right">
		        <a href="#" class="dropdown-toggle" data-toggle="dropdown"><svg class="glyph stroked male-user"><use xlink:href="#stroked-male-user"></use></svg> User <span class="caret"></span></a>
		        <ul class="dropdown-menu" role="menu">
		          <li><a href="#"><svg class="glyph stroked male-user"><use xlink:href="#stroked-male-user"></use></svg> Profile</a></li>
		          <li><a href="#"><svg class="glyph stroked gear"><use xlink:href="#stroked-gear"></use></svg> Settings</a></li>
		          <li><a href="#"><svg class="glyph stroked cancel"><use xlink:href="#stroked-cancel"></use></svg> Logout</a></li>
		        </ul>
		      </li>
		    </ul>
		  </div>
		          
		</div><!-- /.container-fluid -->
	</nav>

  <!--Barra Herramientas-->
	<div id="sidebar-collapse" class="col-sm-3 col-lg-2 sidebar">
		<form role="search">
		  <div class="form-group">
		    <input type="text" class="form-control" placeholder="Search">
		  </div>
		</form>
		<ul class="nav menu">

		  

		  <li class="parent ">
		    <a href="index.html">
		      <span data-toggle="collapse" href="#sub-item-1"><svg class="glyph stroked dashboard-dial"><use xlink:href="#stroked-dashboard-dial"></use></svg></span> Tablero 
		    </a>
		    <ul class="children collapse" id="sub-item-1">
		      <li>
		        <a class="" href="indicadores.html">
		          <svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Indicadores Contingentes
		        </a>
		      </li>
		    </ul>
		  </li>

		<li class="parent">
			<a href="calendar.html">
				<span data-toggle="collapse" href="#subItemGrupo"><svg class='glyph stroked calendar'><use xlink:href="#stroked-calendar"></use></svg></span> Alertas
			</a>

			<ul class="children collapse" id="subItemGrupo">
				<li>
					<a href="grupos.html" >
						<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg>
						Grupos
					</a>
				</li>
				<li>
					<a href="contactos.html">
						<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg>
						Contactos
					</a>
				</li>
				<li>
					<a href="grupocontactos.html">
						<svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg>
						Relacion Contacto - Grupo
					</a>
				</li>				
			</ul>
		</li>
		  
		  <li><a href="reportes.html"><svg class="glyph stroked table"><use xlink:href="#stroked-table"></use></svg> Reportes </a></li>
		  
		  <li><a href="panels.html"><svg class="glyph stroked app-window"><use xlink:href="#stroked-app-window"></use></svg> Alertas </a></li>
		  
		  <li class="parent ">
		    <a href="#">
		      <span data-toggle="collapse" href="#sub-item-1"><svg class="glyph stroked chevron-down"><use xlink:href="#stroked-chevron-down"></use></svg></span> Proceso 
		    </a>
		    <ul class="children collapse" id="sub-item-1">
		      <li>
		        <a class="" href="#">
		          <svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Inscripciones
		        </a>
		      </li>
		      <li>
		        <a class="" href="#">
		          <svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Solicitudes
		        </a>
		      </li>
		      <li>
		        <a class="" href="#">
		          <svg class="glyph stroked chevron-right"><use xlink:href="#stroked-chevron-right"></use></svg> Aprobaciones
		        </a>
		      </li>
		    </ul>
		  </li>
		  <li role="presentation" class="divider"></li>
		  <li><a href="login.html"><svg class="glyph stroked male-user"><use xlink:href="#stroked-male-user"></use></svg> Login Page</a></li>
		</ul>
	</div><!--/.sidebar-->

	<!-- Formulario de edicion de evento -->
	<div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2 main">

		<div class="row">
			<ol class="breadcrumb">
				<li><a href="#"><svg class="glyph stroked home"><use xlink:href="#stroked-home"></use></svg></a></li>
				<li class="active">Contactos</li>
			</ol>
		</div><!--/.row-->

		<div class="row">
			<div class="col-lg-12">
				<h1 class="page-header">Contactos</h1>
			</div>
		</div><!--/.row-->

	 	<div id="contenido" >
	            
	            <!--<input id="btn_usuarios" type="button" class="btn btn-primary" value="Nuevo Grupo"/><br/><br/>-->
	            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">Nuevo Contacto</button><br/><br/>
	            
	            <div class="panel panel-primary">
	                <div class="panel-heading">
	                    <h3 class="panel-title">Listado de  Contactos</h3>
	                </div>
	                <div class="panel-body">
	                    <table id="tablaContactos" class="table table-striped">
	                        <thead>
	                        <th>#</th>
	                        <th>Nombre </th>
	                        <th>Correo</th>
	                        <th>Editar</th>
	                        </thead>
	                        <tbody>
	                           
	                        </tbody>
	                    </table>
	                </div>
	            </div>
	    </div>

	   	<!-- Modal -->
		<div id="myModal" class="modal fade" role="dialog">
		  <div class="modal-dialog">

		    <!-- Modal content-->
		    <div class="modal-content">
		    	<form id="formContacto" class="form-horizontal" role="form">
			      	<div class="modal-header">
			        	<button type="button" class="close" data-dismiss="modal">&times;</button>
			        	<h4 id="modo" class="modal-title">Nuevo</h4>
			        	<h4 class="modal-title">Contacto</h4>
			      	</div>

			      	<div class="modal-body">
			        	<div class="form-group">
			        		<label class="col-lg-2 control-label">Id:</label>
			        		<div class="col-lg-10">
			        			<input id="idContacto" type="text" name="idContacto" class="form-control" disabled="true">
			        		</div>
			        	</div>

						<div class="form-group">
			        		<label class="col-lg-2 control-label">Nombre:</label>
			        		<div class="col-lg-10">
			        			<input id="nombreContacto" type="text" name="nombreContacto" class="form-control">
			        		</div>
			        	</div>

						<div class="form-group">
			        		<label class="col-lg-2 control-label">Correo:</label>
			        		<div class="col-lg-10">
			        			<input id="correo" type="text" name="correo" class="form-control">
			        		</div>
			        	</div>			        	

						<div class="form-group">
			        		<label class="col-lg-2 control-label">Telefono:</label>
			        		<div class="col-lg-10">
			        			<input id="telefono" type="text" name="telefono" class="form-control">
			        		</div>
			        	</div>

						<div class="form-group">
			        		<label class="col-lg-2 control-label">Organizacion:</label>
			        		<div class="col-lg-10">
			        			<input id="organizacion" type="text" name="organizacion" class="form-control">
			        		</div>
			        	</div>

			      	</div>
			      	<div class="modal-footer">
			        	<button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
			        	<button id="guardar" type="submit" class="btn btn-primary" >Guardar</button>
			      </div>
			    </form>
		    </div>

		  </div>
		</div>

	</div>

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="js/moment.min.js"></script>

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<script src="js/bootstrap-datepicker.js"></script>

	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>

    <script type="text/javascript">

	    $(function () {
	    	TableContactos();


	        $("#formContacto").submit(function (event){

	        	$modo = $('#modo').text();

	        	if ($modo == 'Nuevo') {
       		
		        	$nombreContacto = $('#nombreContacto').val();
		        	$correoContacto = $('#correo').val();
		        	$telefonoContacto = $('#telefono').val();
		        	$organizacionContacto = $('#organizacion').val();

		        	$.ajax({
		        		type: "POST",
		        		url: 'actionsCalendar.php',
		        		data: "action=InsertContacto&nombreContacto="+$nombreContacto+"&correo="+$correoContacto+"&telefono="+$telefonoContacto+"&organizacion="+$organizacionContacto
		        	})
		        	.done(function(response){
		        		return true;
		        	})
		        	.fail(function(jqXHR, estado){
		        		console.log("Ha ocurrido un error al insertar nuevo contacto.");
		        	})	
	        	} else {


	        		$idContacto = $('#idContacto').val();
	        		$nombreContacto = $('#nombreContacto').val();
	        		$correoContacto = $('#correo').val();
	        		$telefonoContacto = $('#telefono').val();
	        		$organizacionContacto = $('#organizacion').val();

	        		$.ajax({
	        			type: "POST",
	        			url: 'actionsCalendar.php',
	        			data: "action=UpdateContacto&idContacto="+$idContacto+"&nombreContacto="+$nombreContacto+"&correo="+$correoContacto+"&telefono="+$telefonoContacto+"&organizacion="+$organizacionContacto
	        		})
	        		.done(function(response){
	        			$("#modo").text('Nuevo');

	        			return true;
	        		})
	        		.fail(function(jqXHR, estado){
	        			console.log("Ha ocurrido un error al actualizar grupo.")
	        		})

	        	}

	        });

	    });


 	    function TableContactos() {
	    	$.ajax({
	    		url:'actionsCalendar.php',
	    		type: 'GET',
	    		dataType: 'json',
	    		data: 'action=SelectContactos'
	    	})
	    	.done(function(response) {
	    		var html = '';

	    		if (response.result == true) {
	    			$(response.datos).each(function(i,v) {
	    				html += '<tr>'
	    				html += '<td>'+v.idContacto+'</td>'
	    				html += '<td>'+v.nombre+'</td>'
	    				html += '<td>'+v.correo+'</td>'
	    				html += '<td><button class="btn btn-primary" onclick="editar('+ v.idContacto+')">Editar</button></td>';
	    				html += '</tr>';
	    			})
	    		}else{
	    			html = '<tr><td colspan="6">No se encontraron registros.</td></tr>'

	    		}

	    		$("#tablaContactos tbody").html(html);
	    	})
	    	.fail(function(jqXHR, estado) {
	    		console.log("Ha ocurrido un error al consultar contactos.")
	    	})
	    }

	    function editar(idContacto) {
	    	$("#modo").text('Editar');

	    	$.ajax({
	    		url: 'actionsCalendar.php',
	    		type: 'GET',
	    		dataType: 'json',
	    		data: 'action=SelectContacto&idContacto='+idContacto
	    	})
	    	.done(function(response){

	    		if (response.result == true) {
	    			$(response.datos).each(function(i, v) {
	    				$('#idContacto').val(idContacto);
	    				$('#nombreContacto').val(v.nombre);
	    				$('#correo').val(v.correo);
	    				$('#telefono').val(v.cel);
	    				$('#organizacion').val(v.organizacion);
	    			})
	    		}

	    		$("#myModal").modal('show');
	    	})
	    	.fail(function(jqXHR, estado) {
	    		console.log("Ha ocurrido un error al consultar grupo.")
	    	})

	    	

	    }

	</script>

</body>
</html>